
### **第一部分：用户权限管控模块 (RBAC)**

这个模块是后台系统的核心，我们先从这里开始。

#### **第一轮：整体认知和方案选型 (宏观)**

1.  **【破冰 & 整体描述】** 请你先整体介绍一下这个用户权限管控模块。它要解决一个什么样的业务问题？最终实现了什么样的效果？
2.  **【概念理解】** 你提到了将权限体系拆分为“功能权限”和“数据权限”，能解释一下你对这两者的理解吗？在你们的业务场景下，它们分别对应了什么具体的需求？
3.  **【方案选型-框架】** 你选用了 Sa-Token 这个框架来实现功能权限。当时做技术选型时，有对比过其他主流的权限框架吗？比如 Shiro 或者 Spring Security？为什么最终选择了 Sa-Token？它吸引你的核心优势是什么？
4.  **【方案选型-模型】** 简历上说你采用了 RBAC 模型。在项目初期，除了 RBAC，有没有考虑过其他的权限模型，比如 ABAC（基于属性的访问控制）？你们的场景为什么用 RBAC 就足够了？

#### **第二轮：功能权限实现细节 (微观)**

现在我们深入到功能权限的实现细节里。

1.  **【代码实现】** 在使用 Sa-Token 时，你是如何将“功能权限”与后端的 API 接口进行绑定的？是基于注解，还是通过拦截器/过滤器进行路径匹配？能具体举个例子吗？
2.  **【权限粒度】** 你们的功能权限控制到了什么粒度？是到菜单级别、接口级别，还是页面上的按钮级别？如果是按钮级别，前端和后端是如何配合完成这个校验的？
3.  **【认证流程】** 当一个用户登录时，你能描述一下从前端发起登录请求，到后端使用 Sa-Token 完成认证，再到生成 Token 返回给前端的完整链路吗？这个 Token 里通常包含了哪些信息？你们是如何存储和管理 Token 的？
4.  **【扩展性问题】** 假设现在有一个新的需求：我们需要引入“角色组”的概念，一个角色组可以包含多个角色，用户可以直接被赋予一个角色组。在你现有的设计上，需要做哪些改动来支持这个需求？数据库表结构会如何变化？

#### **第三轮：数据权限实现细节 (核心难点)**

数据权限通常是权限系统里最复杂的部分，我们来重点聊聊你这块的实现。

1.  **【核心原理】** 你提到“通过编写 MyBatis-Plus 拦截器，根据用户角色动态注入 SQL 查询条件”来实现。能详细说明一下这个拦截器的工作原理吗？
    *   它具体拦截的是 MyBatis-Plus 的哪个执行阶段？（比如 `Executor` 的 `query` 方法）
    *   在拦截器内部，你是如何获取到当前发起请求的用户信息的？（提示：`ThreadLocal`）使用 `ThreadLocal` 有没有考虑过它在异步场景或线程池复用下的潜在问题？
2.  **【SQL 拼接】** 动态注入 SQL 查询条件，也就是所谓的“SQL 拼接”。这种方式很容易引发 SQL 注入风险，你是如何防范的？另外，当查询语句本身很复杂，比如包含了多个 `JOIN`、`UNION` 或者子查询时，你的拦截器如何准确、高效地找到需要添加条件的位置并进行改写？有没有遇到过改写出错的情况？
3.  **【性能与场景】**
    *   这个拦截器是否会对所有的查询都生效？如果不是，你是如何区分哪些 SQL 需要增强，哪些不需要的？（比如通过特定注解、命名约定等）
    *   对每一条查询都进行拦截和改写，有没有评估过它带来的性能开销？在高并发场景下，这部分会不会成为瓶颈？
4.  **【方案对比与局限性】**
    *   除了 MyBatis 拦截器这种方式，实现行级别的数据权限还有没有其他方案？（例如：Service 层代码控制、基于数据库 View、使用更专业的数据库代理如 ProxySQL 等）。你认为你选择的方案，和其他方案相比，优缺点分别是什么？
    *   你这个方案有什么局限性？比如，如果一个用户的权限规则非常复杂，不再是简单的“只能看自己部门的数据”，而是“可以看到A部门和B部门所有级别为P5的员工创建的数据”，你的拦截器方案还能方便地支持吗？

### **第二部分：通用心理量表测评引擎**

这个模块看起来技术含量比较高，体现了你抽象和建模的能力，我们来深入聊聊。

#### **第一轮：设计思路与模型抽象**

1.  **【问题背景】** 首先，为什么需要设计一个“通用”的测评引擎？不能针对每一种量表（SCL-90, SDS, SAS）单独写一套计分逻辑吗？“通用”设计带来了哪些好处，又引入了哪些复杂性？
2.  **【模型设计】**
    *   请详细解释一下你的核心模型：“计分因子”和“维度依赖关系”。它们分别是什么？在 SCL-90 这个具体的量表中，你能举例说明什么是计分因子，什么是维度依赖吗？
    *   你提到了“基于有向无环图（DAG）的计算模型”。在这个图里，节点（Vertex）代表什么？边（Edge）又代表什么？
3.  **【数据存储】** 这个“图”的结构，也就是量表的计分规则，你们是如何进行持久化存储的？数据库表是怎么设计的？请大概描述一下核心的几张表和它们之间的关系。

#### **第二轮：核心算法与实现**

1.  **【算法细节】**
    *   你提到了使用“拓扑排序”来确保计算的准确性。请解释一下为什么拓扑排序是解决这个问题的关键？
    *   你能否现场给我描述一下拓扑排序的实现算法吗？（可以是基于 Kahn 算法或 DFS 算法）
    *   当用户提交一份量表答卷后，请完整描述一下，从接收到原始答案，到利用 DAG 模型和拓扑排序，最终计算出所有维度得分的整个过程。
2.  **【鲁棒性与错误处理】**
    *   在设计这个引擎时，你如何处理配置错误的情况？比如，运营人员在后台配置量表规则时，不小心配置出了一个循环依赖（比如：维度A依赖维度B，维度B又依赖维度A），你的系统如何发现并处理这种情况？
    *   如果某个计分因子的计算公式非常特殊，比如需要开方、取对数等，你的引擎如何支持这种自定义计算逻辑？（提示：表达式引擎，如 Aviator, MVEL）
3.  **【扩展性与维护性】**
    *   当需要引入一个新的、计分规则很奇特的量表时，需要开发人员介入写代码吗？还是说运营人员通过后台配置就能完成？你认为理想的“通用引擎”应该达到什么样的状态？
    *   对于已经上线的量表，如果某天发现它的计分规则需要调整，你的系统支持平滑变更吗？这会不会影响已经完成测评的历史数据？

### **第三部分：文件上传与解析模块**

这个模块涉及到了异步处理和中间件，是考察工程实践能力的好例子。

#### **第一轮：整体架构与流程**

1.  **【流程梳理】** 请从用户在前端点击“上传Excel”按钮开始，一直到数据解析入库并通知用户结果，完整地描述一遍这个异步任务的全链路流程。中间涉及到了哪些服务和组件？它们之间是如何交互的？
2.  **【技术选型-MQ】** 为什么要在这里引入 RabbitMQ？直接在上传接口里同步调用 EasyExcel 解析不可以吗？使用消息队列解决了什么核心问题？（解耦、削峰、异步）
3.  **【技术选型-OSS & EasyExcel】**
    *   为什么选择阿里云 OSS 而不是自己搭建文件服务器（比如用 Nginx）？
    *   为什么选择 EasyExcel 而不是更广为人知的 Apache POI？EasyExcel 的核心优势是什么？（提示：内存占用）

#### **第二轮：可靠性与高可用**

在分布式系统中，可靠性是至关重要的。

1.  **【消息可靠性】**
    *   **生产者端**：当你向 RabbitMQ `投递消息` 时，如何确保消息一定被成功投递到了 Broker？（比如：Publisher Confirms 机制）
    *   **消费者端**：你的解析服务作为消费者，如果刚取到消息，还没来得及处理就宕机了，这条消息会丢失吗？你是如何保证消息被成功消费的？（比如：消费端的 `ack` 机制，手动确认模式）
    *   **消息积压**：如果短时间内有大量的 Excel 上传请求，导致 RabbitMQ 中消息严重积压，你有什么应对策略？（增加消费者、优化消费逻辑、设置告警）
2.  **【幂等性处理】** 考虑到网络抖动或重试机制，同一条消息可能会被消费多次。你的 Excel 解析服务是如何保证幂等性的？也就是说，如何避免同一份 Excel 文件被重复解析入库？
3.  **【大文件处理】**
    *   如果用户上传了一个非常大的 Excel 文件（比如包含 100 万行数据），你的解析过程会不会导致消费者服务内存溢出（OOM）？EasyExcel 在这方面有什么机制可以利用？（`SAX` 模式，逐行读取）
    *   这么大的文件解析会非常耗时，可能长达几分钟甚至更久。在这期间，如何让用户感知到处理进度？（比如：WebSocket 推送、状态轮询接口）
4.  **【“毒丸”消息处理】** 如果有一条消息因为格式错误或其他原因，每次消费都会失败，然后又被重新放回队列，导致死循环，不断消耗系统资源。你听说过“死信队列”（Dead-Letter Queue）吗？你会如何设计来处理这种“毒丸”消息？

### **第四部分：综合技术能力考察**

好的，项目我们聊得差不多了，能看出来你做了不少有深度的思考。接下来我们问一些更通用的技术问题。

1.  **【数据库】** 你在项目中用到了 MyBatis-Plus，那问你一个数据库的问题。假设你有一张用户表，数据量很大，现在要根据用户的手机号进行查询，你会做什么优化？（索引）。那你知道 B+ 树索引的原理吗？为什么它适合用在数据库索引上？什么情况下索引会失效？
2.  **【多线程】** 在你的 Excel 解析服务里，为了提高效率，可能会开多线程去处理。你了解 Java 的线程池吗？能讲讲核心的几个参数是什么意思吗？（`corePoolSize`, `maximumPoolSize`, `keepAliveTime`, `workQueue`）。如果让你自己实现一个简单的线程池，你的思路是什么？
3.  **【系统设计】** 假如让你来设计一个类似微博或者朋友圈的“Feed流”系统，你会怎么设计？需要考虑哪些方面？（比如：推模式 vs. 拉模式，写扩散 vs. 读扩散，存储选型，缓存策略等）。
4.  **【学习与反思】** 在你这段实习经历中，遇到的技术挑战最大的一件事是什么？你是如何解决的？回过头来看，你觉得当时的处理方案有没有可以改进的地方？

### **第五部分：反问环节**

好的，我这边的问题差不多就这些了。总的来说，你做的项目还是很有思考的。你有什么想问我的吗？可以关于我们团队、技术栈，或者你关心的其他任何问题。

---

**(面试结束)**