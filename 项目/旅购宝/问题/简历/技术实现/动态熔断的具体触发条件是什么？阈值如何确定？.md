
## 基础熔断规则设置

系统通过`SentinelConfig`类配置了三层基础熔断保护：

1. **响应时间熔断**：
   - 适用于秒杀接口等高频调用场景
   - 初始阈值：平均响应时间超过100ms
   - 触发条件：最少5个请求且平均RT超过阈值
   - 熔断时长：10秒

2. **异常比例熔断**：
   - 适用于创建订单等核心业务
   - 初始阈值：异常比例超过20%
   - 触发条件：最少5个请求且异常率超过阈值
   - 熔断时长：30秒

3. **系统资源保护**：
   - CPU使用率限制：默认75%
   - 最大并发线程数：1600（基于系统塌陷点研究）
   - QPS限制：根据并发阈值动态计算

## 动态触发条件与阈值调整机制

系统根据以下维度动态调整熔断规则：

1. **业务指标异常触发**：
   - 订单失败率突增超过5%时自动降低相应接口并发阈值
   - 秒杀商品超售风险时提高熔断敏感度（RT阈值降低至80ms）

2. **系统资源状态触发**：
   - CPU使用率连续3次采样超过80%时，自动降低全局并发阈值20%
   - 内存使用率超过85%时，拒绝非核心接口请求，保障核心业务

3. **错误趋势触发**：
   - 通过滑动窗口统计接口错误率增长趋势
   - 当错误率增速超过50%时触发预警式熔断，限制新增流量

4. **流量突变触发**：
   - 使用双环比监测算法检测流量突增
   - 当某接口5分钟内流量增长超过300%时，动态调整该接口的熔断参数

## 阈值确定方法

阈值确定采用了多层次方法：

1. **压测数据验证**：
   - 通过压测确认系统临界点为1600并发
   - 响应时间随并发增长曲线分析得出100ms为RT临界点

2. **历史数据分析**：
   - 从监控系统提取正常/异常时期的性能指标
   - 基于历史峰值的80%设置为初始阈值，留出安全余量

3. **自适应阈值学习**：
   - 系统会记录每次熔断前后的关键指标
   - 通过机器学习算法优化阈值，实现熔断精准度提升
   - 每周生成一次阈值调优报告，由运维团队定期审核

4. **业务差异化配置**：
   - 核心接口（支付、下单）采用较保守阈值
   - 非核心接口（查询、浏览）采用较宽松阈值
   - 促销活动期间临时调高阈值，结束后自动恢复

系统通过`SentinelRuleManager`实现规则动态调整，并将更新后的规则持久化到Redis，确保集群一致性，最终实现了在资源消耗和用户体验间的最佳平衡。