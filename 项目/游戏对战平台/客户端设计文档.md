# JavaFX + SpringBoot 游戏大厅客户端设计方案

## 技术选型

### 核心框架
- **JavaFX 21**: UI界面框架，提供跨平台GUI组件
- **Spring Boot 3.1.5**: 应用程序框架，与服务器版本保持一致
- **Spring WebSocket + STOMP**: 实时通信

### UI增强组件
- **JFoenix**: Material Design风格的JavaFX组件，提供现代化UI体验
- **ControlsFX**: 扩展JavaFX控件，提供更丰富的UI组件
- ****Material Icons****: 图标库，提供丰富图标资源

### 网络通信
- **Spring WebClient**: 响应式HTTP客户端，用于REST API调用
- **STOMP over WebSocket**: 实时消息通信
- **Jackson**: JSON序列化与反序列化

### 架构模式
- **MVVM模式**: 使用MVVMFx框架分离UI和业务逻辑
- **依赖注入**: 利用Spring IoC容器管理组件

### 虚拟网络
- **抽象接口层**: 定义虚拟网络通用操作
- **N2N实现层**: 实现N2N网络连接功能

### 辅助工具
- **SLF4J + Logback**: 日志记录
- **Spring Boot DevTools**: 开发工具支持
- **H2数据库**: 本地数据存储（可选）

## 架构设计

### 整体架构图

```
┌───────────────────────────────────────────────────────────┐
│                  客户端应用 (JavaFX + Spring Boot)         │
├───────────┬─────────────────────────────┬─────────────────┤
│           │                             │                 │
│  视图层   │          控制器层           │     模型层      │
│ (JavaFX)  │    (Spring Controllers)     │  (Data Models)  │
│           │                             │                 │
├───────────┴─────────────────────────────┴─────────────────┤
│                                                           │
│                      服务层 (Services)                     │
│   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│   │  用户服务    │  │  房间服务    │  │  消息服务    │    │
│   └──────────────┘  └──────────────┘  └──────────────┘    │
│   ┌──────────────┐  ┌──────────────┐                      │
│   │WebSocket服务 │  │ 虚拟网络服务 │                      │
│   └──────────────┘  └──────────────┘                      │
│                                                           │
├───────────────────────────────────────────────────────────┤
│                                                           │
│                  网络通信层 (Network Layer)                │
│       ┌────────────────┐        ┌─────────────────┐       │
│       │  HTTP 客户端   │        │ WebSocket 客户端 │       │
│       │ (WebClient)    │        │ (STOMP Client)   │       │
│       └────────────────┘        └─────────────────┘       │
│                                                           │
├───────────────────────────────────────────────────────────┤
│                                                           │
│                       虚拟网络层                          │
│     ┌──────────────────────────────────────────┐          │
│     │            虚拟网络接口 (VirtualNetworkService)     │
│     └──────────────────────────────────────────┘          │
│     ┌──────────────────────────────────────────┐          │
│     │            N2N实现 (N2NServiceImpl)               │
│     └──────────────────────────────────────────┘          │
│                                                           │
└───────────────────────────────────────────────────────────┘
      │                                     │
      ▼                                     ▼
┌──────────────┐                    ┌─────────────────┐
│  服务器 REST │                    │  WebSocket 服务  │
│    API       │                    │                 │
└──────────────┘                    └─────────────────┘
```

## 模块详细设计

### 1. 核心模块

#### 1.1 配置模块
- **AppConfig**: 应用程序配置类，负责初始化Spring Boot组件
- **WebSocketConfig**: WebSocket客户端配置
- **NetworkConfig**: 虚拟网络配置

#### 1.2 主应用启动类
- **MainApplication**: JavaFX应用程序入口，集成Spring Boot

### 2. 视图模块

#### 2.1 主要界面
- **LoginView**: 登录/注册界面
- **LobbyView**: 游戏大厅界面
- **RoomListView**: 房间列表界面
- **RoomView**: 房间详情界面
- **GameView**: 游戏界面

#### 2.2 组件
- **UserInfoComponent**: 用户信息显示组件
- **ChatComponent**: 聊天组件
- **PlayerListComponent**: 玩家列表组件

### 3. 服务模块

#### 3.1 用户服务
- **UserService**: 处理用户登录、注册、获取信息等

#### 3.2 房间服务
- **RoomService**: 处理房间创建、加入、退出等

#### 3.3 WebSocket服务
- **WebSocketService**: 管理WebSocket连接和消息
- **StompSessionHandler**: 处理STOMP会话

#### 3.4 虚拟网络服务
- **VirtualNetworkService**: 虚拟网络通用接口
- **N2NService**: N2N网络实现

### 4. 模型模块

#### 4.1 数据模型
- **User**: 用户模型
- **Room**: 房间模型
- **Message**: 消息模型

## 功能流程设计

### 1. 用户认证流程
1. 用户输入用户名和密码
2. 客户端调用`/api/users/login` API
3. 服务器验证并返回用户信息
4. 客户端存储会话信息
5. 建立WebSocket连接并发送`/app/user.connect`消息

### 2. 房间操作流程
1. **创建房间**:
   - 发送`/app/room.create`消息
   - 监听`/user/queue/messages`接收创建结果

2. **加入房间**:
   - 发送`/app/room.join`消息
   - 服务器广播房间状态变更

3. **获取房间列表**:
   - 调用`/api/rooms`或`/api/rooms/by-game/{gameType}`获取房间列表

### 3. 游戏启动流程
1. 房主点击开始游戏
2. 发送`/app/room.start`消息
3. 获取虚拟网络信息(`/api/users/network-info`)
4. 启动N2N连接
5. 进入游戏状态

### 4. 虚拟网络连接流程
1. 接收服务器提供的网络配置
2. 通过接口调用N2N命令
3. 建立点对点连接
4. 监控连接状态并保持心跳

## 客户端关键设计考量

1. **平台无关性**: 使用JavaFX保证在Windows、macOS和Linux上运行一致
2. **响应式UI**: 使用JavaFX属性绑定和MVVM模式实现UI自动更新
3. **模块化**: 清晰的职责分离，便于维护和扩展
4. **错误处理**: 完善的异常处理和用户反馈机制
5. **配置外部化**: 所有配置可在外部配置文件中调整

## 与服务器接口对接说明

客户端将严格按照服务器提供的接口进行对接:

1. **REST API**: 遵循服务器定义的API路径和参数
2. **WebSocket**: 使用服务器定义的主题和消息格式
3. **虚拟网络**: 通过抽象接口调用具体网络实现

通过这样的设计，可以构建一个功能完整、界面友好、易于维护的游戏大厅客户端，同时为未来扩展做好准备。

