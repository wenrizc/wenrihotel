
**一、用户管理与社交功能：**

1.  **用户账户管理：**
    *   用户注册
    *   用户登录与登出
    *   个人资料管理（查看、编辑）
2.  **好友系统：**
    *   好友关系管理（添加、删除好友）
    *   查看好友列表
3.  **用户状态显示：**
    *   实时显示用户在线/离线状态（通过Redis记录的`gateway_id`和状态）

**二、实时聊天功能：**

1.  **多场景聊天：**
    *   **单聊 ：** 用户之间的一对一私聊。
    *   **群聊：**
        *   **大厅聊天：** 公共聊天区域。
        *   **游戏房间内聊天：** 特定游戏房间内的成员聊天。
2.  **消息处理：**
    *   实时消息收发。
    *   消息持久化存储（MySQL），支持历史消息加载。
    *   离线消息存储与推送（当用户上线时）。
    *   消息ACK机制（发送确认、接收确认，确保消息送达）。
    *   消息去重与有序性保障（部分，如会话内消息）。
    *   高并发场景优化（如大厅采用轻量级通知 + 客户端主动拉取）。
3.  **通信协议：**
    *   使用Protobuf进行消息体序列化，提高效率。

**三、游戏房间管理功能：**

1.  **房间操作：**
    *   浏览/查询游戏房间列表。
    *   创建游戏房间。
    *   加入已有游戏房间。
    *   退出游戏房间。
2.  **房间状态管理：**
    *   实时更新和显示房间状态（如等待中、游戏中、人数等）。
    *   实时更新和显示房间内成员列表。
3.  **游戏邀请：**
    *   支持游戏邀请功能（通过信令服务）。

**四、远程联机对战局域网游戏功能 (通过Tailscale/Headscale)：**

1.  **虚拟局域网构建：**
    *   客户端集成`tsnet`库，连接到由Headscale管理的虚拟网络。
    *   为每个加入联机房间的玩家分配虚拟IP。
2.  **P2P连接支持：**
    *   利用Tailscale/WireGuard的NAT穿透能力，辅助玩家建立P2P连接。
    *   可选配置DERP中继服务器以提高连接成功率。
3.  **安全网络隔离与互通：**
    *   通过Headscale的ACL（访问控制列表）和Tags，精确控制同一游戏房间内的玩家节点可以相互通信，而不同房间的玩家相互隔离。
4.  **自动化网络配置：**
    *   当玩家加入/创建支持联机的房间并开始游戏时，系统自动通过VPN管理服务与Headscale交互，为房间成员配置虚拟网络访问权限。
5.  **游戏数据传输：**
    *   局域网游戏数据直接通过`tsnet`创建的P2P（或经由DERP）隧道进行传输。

**五、客户端特性：**

1.  **跨平台GUI：** 使用Wails（Go + Web前端技术）构建。
2.  **本地数据缓存：** 使用SQLite缓存聊天记录、用户配置、消息状态等，提升体验。
3.  **实时通信保障：**
    *   WebSocket长连接管理。
    *   心跳保活机制。

**六、平台级特性（支撑以上功能）：**

1.  **高并发处理潜力：** 架构设计支持水平扩展，目标支撑百万级DAU。
2.  **高性能实时通讯：** 低延迟、高可靠的消息与信令传递。
3.  **异步化与解耦：** 通过RabbitMQ实现服务解耦，提升系统吞吐量和响应速度。
4.  **缓存优先：** Redis用于热点数据缓存和状态管理，提升性能。
5.  **安全机制：**
    *   用户身份认证（Sa-Token）。
    *   API限流、熔断。
6.  **稳定与容错：** 关键服务具备高可用性设计。
