我来为您详细讲解每个文件夹的作用和功能：

## 1. `admin/` - 管理员功能模块

**作用**: 提供系统管理员功能，用于管理和监控整个系统

**主要功能**:
- 系统状态监控
- 用户管理
- 系统配置管理
- 管理员级别的 API 接口
- 系统维护和调试功能

**文件结构**:
- `api.py`: 管理员 API 路由和接口
- `__init__.py`: 模块初始化文件

## 2. `agent/` - AI 代理核心模块

**作用**: 整个 AI 代理系统的核心实现，包含代理的运行逻辑、工具管理和配置

**主要功能**:
- **代理运行引擎**: `run.py` - 代理的主要执行逻辑
- **提示词管理**: `prompt.py`, `gemini_prompt.py` - 不同模型的提示词模板
- **工具系统**: `tools/` - 各种代理工具的实现
- **配置管理**: `config_helper.py` - 代理配置处理
- **版本控制**: `versioning/` - 代理版本管理
- **API 接口**: `api.py` - 代理相关的 API 端点

**关键特性**:
- 支持多种 LLM 模型 (OpenAI, Anthropic, Gemini)
- 动态工具注册和执行
- 代理配置的版本控制
- 流式响应处理
- 上下文管理

## 3. `agentpress/` - 代理通信框架

**作用**: 提供代理与外部系统通信的框架和工具

**主要功能**:
- **线程管理**: `thread_manager.py` - 管理对话线程和状态
- **响应处理**: `response_processor.py` - 处理和格式化代理响应
- **上下文管理**: `context_manager.py` - 管理对话上下文
- **工具注册**: `tool_registry.py` - 工具注册和管理
- **XML 解析**: `xml_tool_parser.py` - 解析 XML 格式的工具调用

**设计模式**:
- 使用发布-订阅模式处理消息
- 支持多种响应格式
- 提供统一的工具接口

## 4. `credentials/` - 凭证管理模块

**作用**: 管理各种第三方服务的 API 密钥和凭证

**主要功能**:
- **凭证存储**: `credential_service.py` - 安全存储和管理凭证
- **配置文件**: `profile_service.py` - 管理用户配置和偏好
- **API 接口**: `api.py` - 凭证相关的 API 端点
- **工具函数**: `utils.py` - 凭证处理工具

**安全特性**:
- 凭证加密存储
- 访问权限控制
- 凭证轮换机制
- 安全审计日志

## 5. `flags/` - 功能开关模块

**作用**: 实现功能开关系统，支持 A/B 测试和渐进式功能发布

**主要功能**:
- **开关管理**: `flags.py` - 功能开关的定义和管理
- **设置配置**: `setup.py` - 开关系统的初始化配置
- **API 接口**: `api.py` - 开关相关的 API 端点

**应用场景**:
- 新功能灰度发布
- A/B 测试
- 紧急功能回滚
- 环境特定配置

## 6. `knowledge_base/` - 知识库模块

**作用**: 管理文档和知识库，为代理提供知识检索能力

**主要功能**:
- **文件处理**: `file_processor.py` - 处理各种格式的文档
- **API 接口**: `api.py` - 知识库相关的 API 端点
- 文档上传和解析
- 向量化存储
- 语义搜索
- 知识检索

**支持格式**:
- PDF, Word, Excel, 文本文件
- 图片 OCR
- 网页内容

## 7. `mcp_module/` - MCP (Model Context Protocol) 模块

**作用**: 实现 MCP 协议，支持与外部工具和服务的集成

**架构设计**:
- **领域层**: `domain/` - 业务实体和逻辑
- **服务层**: `services/` - 业务服务实现
- **仓储层**: `repositories/` - 数据访问层
- **基础设施层**: `infrastructure/` - 外部服务集成
- **外观层**: `facade.py` - 统一的服务接口
- **支持工具**: `support/` - 辅助工具和配置

**主要功能**:
- MCP 协议实现
- 工具发现和注册
- 连接管理
- 协议适配器

## 8. `pipedream/` - Pipedream 集成模块

**作用**: 与 Pipedream 工作流平台集成，支持自动化工作流

**架构设计**:
- **领域层**: `domain/` - 工作流和连接实体
- **服务层**: `services/` - 工作流管理服务
- **仓储层**: `repositories/` - 数据持久化
- **支持工具**: `support/` - HTTP 客户端和加密服务
- **外观层**: `facade.py` - 统一的工作流接口

**主要功能**:
- 工作流创建和管理
- 连接配置
- 事件触发
- 数据同步

## 9. `sandbox/` - 沙箱执行环境

**作用**: 提供安全的代码执行环境，支持代码解释器功能

**主要功能**:
- **沙箱管理**: `sandbox.py` - 沙箱环境的创建和管理
- **工具基础**: `tool_base.py` - 沙箱工具的基础类
- **Docker 集成**: `docker/` - 容器化沙箱环境
- **API 接口**: `api.py` - 沙箱相关的 API 端点

**安全特性**:
- 容器隔离
- 资源限制
- 网络隔离
- 文件系统沙箱

## 整体架构总结

这些模块构成了一个完整的 AI 代理系统：

### 核心层
- **agent/**: AI 代理的核心逻辑
- **agentpress/**: 通信和响应处理框架

### 集成层
- **mcp_module/**: 外部工具集成
- **pipedream/**: 工作流自动化
- **sandbox/**: 安全代码执行

### 支持层
- **credentials/**: 凭证管理
- **knowledge_base/**: 知识库
- **flags/**: 功能开关

### 管理层
- **admin/**: 系统管理

### 设计模式
- **分层架构**: 清晰的职责分离
- **依赖注入**: 松耦合的模块设计
- **外观模式**: 统一的接口抽象
- **仓储模式**: 数据访问抽象

这种模块化设计确保了系统的可扩展性、可维护性和可测试性，每个模块都有明确的职责和边界。