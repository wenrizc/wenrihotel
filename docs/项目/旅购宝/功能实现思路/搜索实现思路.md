
## 1. 基础架构设计

当前项目采用了基于ElasticSearch的商品搜索系统，整体架构遵循了分层设计原则：

- **索引层**：使用[ProductDocument]建立ES文档模型，定义字段映射和分析器配置
- **持久层**：通过`ProductRepository`接口对接ES操作，继承自`ElasticsearchRepository`
- **服务层**：`ProductSearchService`接口和`ProductSearchServiceImpl`实现类处理业务逻辑
- **控制层**：`ProductController`提供对外的REST接口

## 2. 文档模型设计

商品文档模型[ProductDocument]通过ES注解实现了精细的字段设计：

- 关键字段使用了合适的ES数据类型，如ID为keyword类型，描述为text类型
- 对文本字段（名称、描述）使用了IK中文分词器，提高中文搜索准确度
- 对不同字段设置了不同的分析策略，如名称字段使用了ik_max_word（最细粒度分词）进行索引，ik_smart（智能分词）进行搜索

## 3. 数据同步机制

项目采用了多级同步策略确保MySQL与ES数据一致性：

- **主动同步**：商品创建、更新、状态变更时主动调用[syncProductToES]方法同步到ES
- **被动同步**：利用UnifiedCache缓存系统查询数据，确保获取最新数据后再同步到ES
- **缓存联动**：与缓存系统结合，在必要时从数据库重新加载数据再同步

系统设计了针对数据不存在情况的处理流程，对于已删除的商品可通过[deleteProductFromES]方法从ES中移除。

## 4. 查询策略设计

搜索功能实现了多条件复合查询模式：

- **关键词搜索**：使用多字段匹配(name和description)，增加搜索广度
- **分类过滤**：支持按商品分类ID进行精确过滤
- **状态筛选**：默认只返回上架状态(status=1)的商品，确保结果有效
- **分页查询**：采用标准分页参数(page, size)支持结果分页

查询构建采用`CriteriaQuery`方式，通过动态条件组装实现灵活的搜索参数组合。

## 5. 集成与优化

项目在集成方面做了多层次优化：

- **与缓存系统集成**：利用UnifiedCache实现对查询结果的缓存，提高热门搜索词的响应速度
- **异常处理**：对搜索过程中可能出现的异常进行捕获和日志记录，返回友好的错误信息
