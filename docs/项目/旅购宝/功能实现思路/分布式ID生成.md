
系统实现了高效可靠的分布式ID生成器，用于生成订单号等全局唯一标识符。

### 核心设计思路

项目采用多种ID生成策略并根据场景灵活选择：

- **雪花算法（Snowflake）**：主要用于高性能ID生成
- **号段模式**：适用于订单号等需要连续性的场景
- **Redis自增**：用于简单计数场景的ID生成

### 雪花算法实现

系统实现了优化版雪花算法，解决传统雪花算法的局限性：

- **时钟回拨处理**：检测到时钟回拨时等待或使用备用生成器
- **工作机器ID自动分配**：通过ZooKeeper动态分配workerId
- **位数优化**：调整各部分位数分配，适应业务需求

### 号段模式

适用于订单号等需要业务规则的场景：

- **预分配号段**：从数据库一次获取一批号段（如1000个）
- **本地生成**：在内存中快速分配，避免频繁访问数据库
- **号段用尽**：当号段用尽时再次从数据库申请新号段

号段表设计：

CREATE TABLE id_generator (

    biz_tag VARCHAR(128) NOT NULL COMMENT '业务标识',

    max_id BIGINT NOT NULL COMMENT '当前最大ID',

    step INT NOT NULL COMMENT '号段长度',

    version INT NOT NULL COMMENT '乐观锁版本号',

    PRIMARY KEY (biz_tag)

);

### 业务号码生成器

针对订单号等业务场景，实现了规则化ID生成器：

- **前缀区分**：根据业务类型添加不同前缀（如O-订单,P-支付,R-退款）
- **时间编码**：嵌入时间信息（如yyMMdd）
- **随机后缀**：添加随机数防止规律性泄露业务信息

示例实现，订单号格式为：O + yyMMdd + 6位自增序号 + 3位随机数