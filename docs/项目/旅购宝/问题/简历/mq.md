
# 数据库变更捕获与一致性保障面试问题

作为高级面试官，我准备了一系列问题，从不同角度深入探讨你在项目中使用Canal+RabbitMQ实现数据一致性的经验：

## 架构设计相关问题

1. **请介绍你在项目中实现的Canal+RabbitMQ数据同步整体架构，以及为什么选择这种方案而不是其他替代方案？**

2. **在你的实现中，Canal与RabbitMQ是如何配合工作的？数据流向是怎样的？能画出核心组件的交互流程图吗？**

3. **你的方案如何处理多模块、多数据源之间的数据一致性问题？特别是Redis缓存和ES索引的更新策略是什么？**

## 技术原理与实现细节

1. **从代码可以看到你使用了CanalClient监听binlog，能否解释一下Canal工作原理以及binlog格式选择的考虑？**

2. **请详细说明你如何实现消息的幂等性处理？看到你使用了messageId和Redis去重，为什么需要这样做？**

3. **你在CacheMessageListener中实现的消息处理逻辑是怎样的？特别是对于不同类型数据库操作(INSERT/UPDATE/DELETE)的处理策略有何不同？**

## 异常处理与可靠性

1. **如果Canal服务或RabbitMQ出现故障，你的系统如何应对？有哪些容错和恢复机制？**

2. **在你的CanalClient实现中，有这样的代码：`connector.rollback(batchId);`，能解释一下在什么情况下会触发回滚以及这样做的目的吗？**

3. **你如何确保在消息处理过程中的原子性？如果缓存删除成功但ES更新失败，会导致什么问题？你是如何解决的？**

## 性能优化

1. **你的系统处理高并发数据变更时会面临哪些挑战？你采取了哪些措施优化性能？**

2. **你是如何处理大批量数据变更的？有没有考虑过批量处理而不是逐条处理的方案？**

## 实际应用与效果

1. **这套方案在生产环境中运行后，遇到过哪些问题？你是如何监控和排查问题的？**

2. **实施这套方案后，数据一致性问题得到了多大程度的改善？能提供一些具体的指标数据吗？**

3. **如果现在让你重新设计这个方案，你会做哪些改进？**

这些问题将帮助我了解你对项目技术细节的掌握程度以及实际解决问题的能力。请选择其中几个你最有把握的问题回答。