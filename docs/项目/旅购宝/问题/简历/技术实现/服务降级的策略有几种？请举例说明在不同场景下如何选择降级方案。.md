
## 主要降级策略类型

系统实现了以下六种降级策略：

### 1. 返回缓存数据降级

通过`CacheFallbackHandler`实现，在服务不可用时返回旧缓存数据。

**应用场景**：
- 商品详情页面展示
- 用户评价列表
- 热门景点推荐

**实现示例**：当获取景点详情服务不可用时，返回TTL未完全过期的旧数据，并标记为"非实时数据"。

### 2. 返回默认值降级

通过`DefaultValueFallbackHandler`实现，返回预设的安全默认值。

**应用场景**：
- 非关键功能的数据查询
- 装饰性内容展示
- 统计类数据展示

**实现示例**：库存查询服务过载时，返回"库存紧张"而非具体数量，避免查询失败导致页面错误。

### 3. 服务功能降级

通过`FeatureFallbackHandler`实现，暂时关闭某些非核心功能。

**应用场景**：
- 高峰期关闭推荐系统
- 限制深度分页查询
- 禁用复杂排序选项

**实现示例**：秒杀期间自动关闭商品详情页的"相似商品推荐"功能，将计算资源集中在核心交易流程上。

### 4. 请求合并降级

通过`RequestMergingHandler`实现，将多个独立请求合并处理。

**应用场景**：
- 批量查询用户状态
- 多商品价格获取
- 购物车商品库存查询

**实现示例**：当系统负载过高时，把1秒内的多个单商品库存查询合并为一次批量查询，减少数据库访问次数。

### 5. 异步化降级

通过`AsyncProcessingHandler`实现，将同步请求转为异步处理。

**应用场景**：
- 订单确认流程
- 积分更新操作
- 用户操作日志记录

**实现示例**：订单系统过载时，支付成功后返回"订单处理中"状态，在后台异步完成订单确认和物流通知。

### 6. 业务规则简化

通过`BusinessSimplificationHandler`实现，简化业务规则处理逻辑。

**应用场景**：
- 简化价格计算规则
- 关闭复杂优惠组合
- 限制自定义查询条件

**实现示例**：促销高峰期暂时关闭"多优惠券叠加使用"功能，改为自动应用最优单券，简化订单金额计算流程。

## 降级方案选择策略

### 场景一：秒杀活动高峰期

**系统特点**：流量突发、下单转化关键

**推荐降级方案**：
1. 优先采用**服务功能降级**，关闭评论、推荐等非交易核心功能
2. 结合**业务规则简化**，限制复杂优惠计算
3. 对售罄商品采用**返回缓存数据降级**，减少库存查询压力

### 场景二：支付系统临时故障

**系统特点**：核心业务受阻，需保障用户体验

**推荐降级方案**：
1. 主要采用**异步化降级**，接受订单但后台异步处理
2. 配合**返回默认值降级**，展示"处理中"状态而非错误
3. 启用**请求合并降级**，合并支付状态查询请求

### 场景三：数据库性能下降

**系统特点**：查询响应缓慢，影响整体性能

**推荐降级方案**：
1. 大量使用**返回缓存数据降级**，延长缓存有效期
2. 实施**请求合并降级**，聚合类似查询
3. 对非核心查询使用**服务功能降级**，限制查询深度和频率

### 场景四：用户服务波动

**系统特点**：用户信息查询不稳定

**推荐降级方案**：
1. 采用**返回默认值降级**，使用本地缓存的基础用户信息
2. 结合**异步化降级**处理登录和注册流程
3. 通过**服务功能降级**暂时关闭用户画像推荐功能

## 降级决策与执行流程

系统实施了一套完整的降级决策流程：

1. **自动触发机制**：
   - 基于Sentinel熔断触发相应降级
   - 系统负载超过阈值时逐级激活降级策略

2. **降级优先级**：
   - 优先保障交易链路和支付流程
   - 其次保障核心内容展示
   - 最后保障社交和推荐功能

3. **分级降级实施**：
   - 轻度压力：仅启用缓存延期和合并请求
   - 中度压力：激活功能降级和简化业务规则
   - 重度压力：采用返回默认值和完全异步处理

这种多层次、场景化的降级策略使系统在面对不同类型的压力时，能够保持核心功能可用，提供最佳可能的用户体验。