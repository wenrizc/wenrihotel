
### 1. 线程池是什么

线程池是一种基于“池化”思想的线程管理技术。它的核心是，预先创建好一定数量的线程并把它们放在一个“池子”里进行统一管理，当有任务需要执行时，就从池中取出一个空闲的线程来执行任务，任务执行完毕后，这个线程并不会被销毁，而是会返回池中等待下一个任务。


使用线程池的主要好处有三个：

1. 降低资源消耗：通过复用已创建的线程，显著减少了因频繁创建和销毁线程所带来的系统开销。
    
2. 提高响应速度：当任务到达时，可以直接从池中获取线程执行，免去了创建线程所需的时间，从而能够更快地响应。
    
3. 提高线程的可管理性：线程池可以对池中的线程进行统一的分配、调优和监控，避免了因无限制地创建线程而耗尽系统资源。
    

在Java中，线程池的核心实现类是 `java.util.concurrent.ThreadPoolExecutor`。

### 2. 线程池的核心参数

`ThreadPoolExecutor` 的构造函数提供了几个核心参数，理解这些参数是理解线程池工作原理的关键。

1. **corePoolSize (核心线程数)**
    
    - 描述：线程池中长期保持的线程数量，即使它们处于空闲状态，也不会被回收（除非设置了 `allowCoreThreadTimeOut`）。这是线程池的基本大小。
        
2. **maximumPoolSize (最大线程数)**
    
    - 描述：线程池能够容纳同时执行的最大线程数。当工作队列满了之后，如果当前线程数小于最大线程数，线程池会创建新的“非核心线程”来处理任务。
        
3. **keepAliveTime (线程空闲存活时间)**
    
    - 描述：当线程池中的线程数量超过 `corePoolSize` 时，这个参数决定了多余的空闲线程（即非核心线程）在被终止前可以存活的最长时间。
        
4. **unit (存活时间单位)**
    
    - 描述：为 `keepAliveTime` 参数指定时间单位，如秒（SECONDS）、毫秒（MILLISECONDS）等。
        
5. **workQueue (工作队列)**
    
    - 描述：一个阻塞队列（BlockingQueue），用于存放当所有核心线程都在忙碌时，新提交的、等待执行的任务。
        
    - 常见的队列类型有：
        
        - `ArrayBlockingQueue`：基于数组的有界阻塞队列。
            
        - `LinkedBlockingQueue`：基于链表的、容量可选的阻塞队列（默认是无界的）。
            
        - `SynchronousQueue`：一个不存储元素的阻塞队列，每个插入操作必须等待一个移除操作，反之亦然。
            
6. **threadFactory (线程工厂)**
    
    - 描述：一个用于创建新线程的工厂。通过自定义线程工厂，我们可以为线程池中的每个线程设置一个有意义的名字、指定为守护线程、或者设置优先级等。
        
7. **rejectedExecutionHandler (拒绝策略)**
    
    - 描述：当线程池和工作队列都满了，无法再处理新提交的任务时，所采取的策略。
        
    - JDK默认提供了四种策略：
        
        - `AbortPolicy` (默认)：直接抛出 `RejectedExecutionException` 异常。
            
        - `CallerRunsPolicy`：由提交任务的那个线程自己来执行这个任务。
            
        - `DiscardPolicy`：直接悄悄地丢弃这个任务，不抛异常也不执行。
            
        - `DiscardOldestPolicy`：丢弃工作队列中最旧的一个任务，然后重新尝试提交当前任务。
            

