
MySQL的索引，特别是其最常用的InnoDB存储引擎，选择B+树作为主要的索引结构，而不是其他数据结构如二叉查找树、AVL树、红黑树或B树，是出于对磁盘I/O特性和数据库查询模式的深度优化和权衡。

以下是MySQL索引使用B+树的几个核心原因：

1.  减少磁盘I/O次数，适应磁盘存储特性：
    *   数据库的数据和索引通常存储在磁盘上，而磁盘I/O的成本远高于内存中的操作。减少磁盘I/O是提高数据库性能的关键。
    *   B+树是一种多路（multi-way）平衡查找树，它的每个节点可以存储大量的键和指针。这意味着B+树的“扇出”（fan-out）非常大。
    *   大的扇出使得B+树的高度非常低。例如，一个高度为3的B+树就可以存储千万级别甚至上亿级别的数据。
    *   查找一条数据时，需要从根节点遍历到叶子节点，所需的磁盘I/O次数与树的高度成正比。由于B+树的高度极低，查找数据所需的磁盘I/O次数就非常少，通常只需要几次I/O。
    *   相比之下，二叉树（包括红黑树）的高度是`O(log N)`，如果N很大，树会非常深，导致I/O次数过多，不适合磁盘存储。

2.  内部节点不存储数据，进一步降低树的高度：
    *   这是B+树相对于B树的一个关键优势。B+树的内部节点只存储键（作为索引）和指向子节点的指针，不存储任何与键关联的实际数据。
    *   这意味着在同样大小的磁盘块（页）中，B+树的内部节点可以容纳比B树更多的键和指针。这使得B+树的扇出更大，树的高度可以做得比同阶的B树更低，从而进一步减少了磁盘I/O次数。
    *   例如，假设一个磁盘页大小为16KB，一个键和指针的组合大小为几十字节，一个内部节点就可以存储成百上千个这样的组合，扇出非常大。

3.  高效的范围查询和顺序扫描：
    *   B+树将所有的数据记录都存储在叶子节点上。
    *   更重要的是，所有叶子节点通过指针串联起来，形成一个有序的双向（或单向）链表。
    *   这个特性使得范围查询（如`WHERE id BETWEEN 100 AND 200`）和排序查询（`ORDER BY`）变得非常高效。一旦通过树的查找定位到范围的起始叶子节点，就可以直接沿着叶子节点的链表顺序遍历所有符合条件的数据，而无需回溯树的结构。这利用了磁盘的顺序读特性，比随机读快得多。
    *   B树的数据分布在所有节点，进行范围查询时可能需要进行复杂的中序遍历，涉及在不同层级的节点间来回跳转，I/O效率较低。

4.  稳定的查询性能：
    *   由于所有数据都在叶子节点，任何一次查询（无论是命中还是未命中）都必须从根节点走到叶子节点，其查询路径的长度是相同的（等于树的高度）。
    *   这使得B+树的查询性能非常稳定，不会像B树那样，因为数据可能在内部节点被找到而导致查询路径长度不一。

5.  与数据库页（Page）的良好配合：
    *   数据库管理系统通常以页（Page）为单位来管理磁盘存储和内存缓冲。一个页的大小通常是固定的（如InnoDB默认为16KB）。
    *   B+树的节点大小可以设计为与数据库页的大小相匹配。这样，每次从磁盘读取一个节点，就是一次I/O操作，正好读取一个完整的页，最大化了I/O的效率。

为什么不用其他数据结构？

*   哈希索引（Hash Index）：
    *   只适合等值查询（`=` 或 `IN`），性能极高，时间复杂度O(1)。
    *   但不支持范围查询、排序查询。
    *   哈希冲突可能导致性能下降。
    *   InnoDB也支持自适应哈希索引（Adaptive Hash Index），但这是在B+树基础上的一种优化，不是主要的索引结构。
*   二叉查找树/AVL树/红黑树：
    *   这些是为内存操作设计的，是二叉树，树的高度相对较高。
    *   在数据量大时，存储在磁盘上会导致大量的磁盘I/O。
    *   它们的平衡调整操作（如旋转）粒度小且频繁，不适合需要按块读写的磁盘。
*   B树：
    *   虽然也是为磁盘优化的多路树，但如前所述，B+树在范围查询和I/O效率上通常更具优势。B树将数据散布在整个树中，范围查询效率不高。同时，内部节点存储数据导致其扇出小于B+树，树的高度可能更高。

MySQL（特别是InnoDB）选择B+树作为索引结构，是经过深思熟虑的工程决策。B+树的多路特性和极低的高度完美地适应了磁盘I/O的特点，最大限度地减少了慢速的磁盘访问次数。其内部节点不存数据、叶子节点存储所有数据并形成有序链表的独特设计，不仅进一步优化了I/O效率，还极大地提升了数据库中非常常见的范围查询和排序操作的性能。这些特性使得B+树成为实现高性能数据库索引的理想选择。

