
### MySQL的常规索引

MySQL索引，在InnoDB存储引擎中，其底层数据结构主要是B+树。它是一种为磁盘等外部存储设备设计的多路平衡查找树，目的是为了降低I/O操作次数，从而提高查询效率。

#### 1. 结构与原理

- **B+树的特点**：
    
    - 它是一棵“矮胖”的树。相比于二叉树，B+树每个节点可以存储更多的关键字（索引键），因此树的高度非常低，通常3到4层就能支持千万甚至上亿级别的数据量。
        
    - 数据都存储在叶子节点。非叶子节点（或称为内部节点）只存储索引键和指向下一层节点的指针，不存储具体的行数据。这样做的好处是，一个磁盘页（Page，InnoDB中默认为16KB）可以容纳更多的索引键，进一步降低树的高度。
        
    - 所有叶子节点形成一个有序的双向链表。这个设计对于范围查询（如 `WHERE id > 100`）非常友好，找到一个边界后，可以直接通过链表指针顺序向后（或向前）遍历，而不需要再从根节点开始回溯查找。
        
- 工作原理：
    
    当执行一个SQL查询时，例如 SELECT * FROM user WHERE id = 10，MySQL会从B+树的根节点开始，通过比较索引键值，逐层向下查找，最终定位到包含目标数据的叶子节点。由于树的高度很低，这个过程通常只需要几次磁盘I/O，速度非常快。
    
- **分类**：
    
    - **聚簇索引**：在InnoDB中，主键索引就是聚簇索引。它的叶子节点直接存储了完整的行数据。因此，一张表只有一个聚簇索引。
        
    - **非聚簇索引**：也叫辅助索引。它的叶子节点存储的是索引列的值和对应行的主键值。当使用非聚簇索引查询时，如果查询的列包含了非索引列，会先通过该索引找到主键，然后再用主键去聚簇索引中查找完整的行数据，这个过程称为“回表”。
        

#### 2. 适用场景

MySQL的B+树索引非常适合以下场景：

- **精确匹配查询**：`WHERE id = ?` 或 `WHERE name = 'xxx'`。
    
- **范围查询**：`WHERE age > 18` 或 `WHERE created_at BETWEEN '2023-01-01' AND '2023-12-31'`。
    
- **排序（ORDER BY）和分组（GROUP BY）**：如果排序或分组的字段正好是索引，可以利用索引的有序性，避免额外的排序开销。
    

---

### 倒排索引

倒排索引，也叫反向索引，是另一种完全不同的索引结构。它的核心思想不是“从文档/记录找词”，而是“从词找文档/记录”。它主要被用在全文搜索引擎领域，比如Elasticsearch、Solr等。

#### 1. 结构与原理

倒排索引主要由两部分组成：

- **单词词典（Term Dictionary）**：包含了所有文档中出现过的单词（经过分词、标准化处理后），并记录了每个单词的一些统计信息，如出现的文档频率等。词典通常会用B+树或哈希表等结构来存储，以便快速查找。
    
- **倒排列表（Posting List）**：这是核心部分。对于词典中的每一个单词，都有一个与之对应的列表，这个列表记录了所有包含该单词的文档ID，甚至还可能包括单词在该文档中出现的位置、次数、偏移量等信息。
    
- 工作原理：
    
    假设我们有三份文档：
    
    - 文档1: "MySQL is a popular database."
        
    - 文档2: "We use MySQL and Elasticsearch."
        
    - 文档3: "Elasticsearch is a search engine."
        
    
    建立倒排索引的过程是：
    
    1. **分词**：将每个文档拆分成单词，如 "MySQL", "is", "a", "popular", "database"。
        
    2. **构建索引**：创建一个从单词到文档ID的映射。
        
        - "MySQL": {文档1, 文档2}
            
        - "is": {文档1, 文档3}
            
        - "Elasticsearch": {文档2, 文档3}
            
        - ... (以此类推)
            
    
    当用户搜索 "MySQL" 时，系统会：
    
    3. 在单词词典中快速定位到 "MySQL"。
        
    4. 获取其对应的倒排列表 {文档1, 文档2}。
        
    5. 返回这两份文档作为结果。
        
        对于多词查询，比如 "MySQL AND Elasticsearch"，系统会分别找到两个词的倒排列表，然后对这两个列表求交集，得到最终结果 {文档2}。
        

#### 2. 适用场景

倒排索引的核心优势在于处理文本内容的全文检索：

- **全文搜索**：在大量文本数据中快速查找包含一个或多个关键词的文档，例如搜索引擎、站内搜索、日志分析平台。
    
- **模糊查询**：尤其适合 `LIKE '%keyword%'` 这种B+树索引无能为力的场景。
    
- **多条件组合查询**：通过对倒排列表进行交、并、差等集合运算，高效处理复杂的布尔查询。
    

虽然MySQL本身支持全文索引（FULLTEXT Index），其底层也是一种倒排索引的实现，但在功能、性能和灵活性上，与专业的搜索引擎如Elasticsearch相比还有差距。
